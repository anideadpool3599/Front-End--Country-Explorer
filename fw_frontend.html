<!DOCTYPE html>
<html>
    <head>
        
        <script>
            var countrydata;
            function getCountries(){
                var countryname = document.getElementById("txtcountry").value;
                document.getElementById("divresults").innerHTML = "";
                if(countryname == ""){
                    alert("Please enter country name in part or full");
                    return;
                }  
                try
                {
                    fetch('https://restcountries.eu/rest/v2/name/' + countryname)
                    .then(function(response) {
                        return response.json();
                    })
                    .then(function(JSONresult) {
            
                        if(JSONresult.status != null){
                            if(JSONresult.status == 404){
                                alert("No data was retrieved. Please try a different name.");
                            }
                        }
                        else{
                            var htmlString = "";
                            console.log(JSONresult.length);
                            countrydata = JSONresult;
                            for(var x= 0 ; x< JSONresult.length;x++){
                                console.log(JSONresult[x]);
                                //console.log(JSONresult[x].flag);
                                htmlString += "<div class='divfourthleftmargin15'><div class='card'>";
                                htmlString += "<div class='card_content'>";
                                htmlString += "<div class='card_title'>";
                                htmlString += "<a href='#' onclick='loadCountry(\"" + JSONresult[x].name + "\")'>";   
                                htmlString += JSONresult[x].name;
                                htmlString += "</a>";    
                                htmlString += "</div>";
                                htmlString += "<div class='card_text'>";
                                htmlString += "<img src='" + JSONresult[x].flag + "' width='200' height='auto'>";
                                htmlString += "</div>";
                                htmlString += "</div>";
                                htmlString += "</div>";
                                htmlString += "</div>";
                            }
                            document.getElementById("divresults").innerHTML = htmlString;
                        }
                    });
                }
                catch{
                    alert("No data was retrieved. Please check network connection.");
                
                }   
            }
            
            function loadCountry(countryname){
                for(var x= 0 ; x < countrydata.length; x++){
                    if(countryname == countrydata[x].name){
                        document.cookie = "country=" + JSON.stringify(countrydata[x]);
                        window.location.href = "fw_frontend_country.html";
                        //return;
                    }
                }
            }
            //WHEN USER CLICKS ON BACK FROM DETAILS 
            //WE WILL CHECK IF COUNTRY NAME IS ALREADY AND RELOAD THOSE RESULTS
            function reloadCountries(){
                var countryname = document.getElementById("txtcountry").value;
                    if(countryname != ""){
                        getCountries();
                    }
            }
        </script>
        <link href="fw_frontend.css" rel="stylesheet"/>
    </head>
    <body onload="reloadCountries()">
        <div class="divfull">
            <div class="divhalf">
                <div class="divthirdleft">
                    Enter a country name
                </div>
                <div class="divthirdleft">
                    <input type="text" name="txtcountry" id="txtcountry" length="50">
                </div>
                <div class="divthirdright">
                    <button name="btnsubmit" id="btnsubmit" onclick="getCountries()">Search</button>
                </div>
            </div>
        </div>
        <div id="divresults" class="divfull">

        </div>
    </body>
</html>